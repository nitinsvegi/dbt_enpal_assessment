{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.11", "generated_at": "2025-09-25T04:56:44.723856Z", "invocation_id": "be2943be-3a1b-4dc7-aed7-8054247a8349", "invocation_started_at": "2025-09-25T04:56:43.802457Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-25T04:56:44.398920Z", "completed_at": "2025-09-25T04:56:44.408392Z"}, {"name": "execute", "started_at": "2025-09-25T04:56:44.408612Z", "completed_at": "2025-09-25T04:56:44.572199Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.17405200004577637, "adapter_response": {"_message": "INSERT 0 0", "code": "INSERT", "rows_affected": 0}, "message": "INSERT 0 0", "failures": null, "unique_id": "model.enpal_assessment_project.rep_sales_funnel_monthly", "compiled": true, "compiled_code": "\n\n-- Aggregates deal and activity data to create a monthly sales funnel view.\n\n-- Column definitions:\n-- month: Month of the activity or stage change (first day of month)\n-- kpi_name: Name of the KPI corresponding to the funnel step\n-- funnel_step: Funnel step identifier (Step 1, Step 2.1, etc.)\n-- deals_count: Count of unique deals in that month and funnel step\n\nWITH\n-- Stage-based funnel steps (from int_deal_changes)\nstage_funnel AS (\n    SELECT\n        -- EXTRACT(MONTH FROM deal_change_timestamp) AS month\n        TO_CHAR(deal_change_timestamp, 'MM-YYYY') AS month_year\n        ,  CASE \n            WHEN stage_name = 'Lead Generation' THEN 'Stage: Lead Generation'\n            WHEN stage_name = 'Qualified Lead' THEN 'Stage: Qualified Lead'\n            WHEN stage_name = 'Needs Assessment' THEN 'Stage: Needs Assessment'\n            WHEN stage_name = 'Proposal/Quote Preparation' THEN 'Stage: Proposal/Quote Preparation'\n            WHEN stage_name = 'Negotiation' THEN 'Stage: Negotiation'\n            WHEN stage_name = 'Closing' THEN 'Stage: Closing'\n            WHEN stage_name = 'Implementation/Onboarding' THEN 'Stage: Implementation/Onboarding'\n            WHEN stage_name = 'Follow-up/Customer Success' THEN 'Stage: Follow-up/Customer Success'\n            WHEN stage_name = 'Renewal/Expansion' THEN 'Stage: Renewal/Expansion'\n            ELSE NULL\n          END AS kpi_name\n        , CASE \n            WHEN stage_name = 'Lead Generation' THEN 'Step 1'\n            WHEN stage_name = 'Qualified Lead' THEN 'Step 2'\n            WHEN stage_name = 'Needs Assessment' THEN 'Step 3'\n            WHEN stage_name = 'Proposal/Quote Preparation' THEN 'Step 4'\n            WHEN stage_name = 'Negotiation' THEN 'Step 5'\n            WHEN stage_name = 'Closing' THEN 'Step 6'\n            WHEN stage_name = 'Implementation/Onboarding' THEN 'Step 7'\n            WHEN stage_name = 'Follow-up/Customer Success' THEN 'Step 8'\n            WHEN stage_name = 'Renewal/Expansion' THEN 'Step 9'\n            ELSE NULL\n          END AS funnel_step\n        , deal_id\n    FROM \"postgres\".\"public_pipedrive_analytics\".\"int_deal_changes\"\n    WHERE TRUE\n        AND stage_name IS NOT NULL\n),\n\n-- Activity-based funnel steps (from int_activity)\nactivity_funnel AS (\n    SELECT\n        -- EXTRACT(MONTH FROM activity_due_timestamp) AS month\n        TO_CHAR(activity_due_timestamp, 'MM-YYYY') AS month_year\n        , CASE \n            WHEN activity_type_short = 'meeting' THEN 'Activity: Sales Call 1'\n            WHEN activity_type_short = 'sc_2' THEN 'Activity: Sales Call 2'\n            WHEN activity_type_short = 'follow_up' THEN 'Activity: Follow-up/Customer Success'\n            WHEN activity_type_short = 'after_close_call' THEN 'Activity: Closing'\n            ELSE NULL\n          END AS kpi_name\n        , CASE \n            WHEN activity_type_short = 'meeting' THEN 'Step 2.1'\n            WHEN activity_type_short = 'sc_2' THEN 'Step 3.1'\n            WHEN activity_type_short = 'after_close_call' THEN 'Step 6'\n            WHEN activity_type_short = 'follow_up' THEN 'Step 8'\n            ELSE NULL\n         END AS funnel_step\n        , deal_id\n    FROM \"postgres\".\"public_pipedrive_analytics\".\"int_activity\"\n    WHERE TRUE\n        AND activity_type_short IN ('meeting','sc_2','follow_up','after_close_call')\n),\n\n-- Lost Reason-based funnel steps (from int_deal_changes)\nlost_reason_funnel AS (\n    SELECT\n        TO_CHAR(deal_change_timestamp, 'MM-YYYY') AS month_year\n        , CASE \n            WHEN lost_reason_name = 'Customer Not Ready' THEN 'Lost Reason: Customer Not Ready'\n            WHEN lost_reason_name = 'Pricing Issues' THEN 'Lost Reason: Pricing Issues'\n            WHEN lost_reason_name = 'Unreachable Customer' THEN 'Lost Reason: Unreachable Customer'\n            WHEN lost_reason_name = 'Product Mismatch' THEN 'Lost Reason: Product Mismatch'\n            WHEN lost_reason_name = 'Duplicate Entry' THEN 'Lost Reason: Duplicate Entry'\n            ELSE NULL\n        END AS kpi_name\n        , CASE \n            WHEN lost_reason_name = 'Customer Not Ready' THEN 'Step 1'\n            WHEN lost_reason_name = 'Pricing Issues' THEN 'Step 2'\n            WHEN lost_reason_name = 'Unreachable Customer' THEN 'Step 3'\n            WHEN lost_reason_name = 'Product Mismatch' THEN 'Step 4'\n            WHEN lost_reason_name = 'Duplicate Entry' THEN 'Step 5'\n            ELSE NULL\n        END AS funnel_step\n        , deal_id\n    FROM \"postgres\".\"public_pipedrive_analytics\".\"int_deal_changes\"\n    WHERE TRUE\n    AND lost_reason_name IS NOT NULL\n),\n\n-- Union all funnel events\nall_funnel AS (\n    SELECT * FROM stage_funnel\n    UNION ALL\n    SELECT * FROM activity_funnel\n    UNION ALL\n    SELECT * FROM lost_reason_funnel\n),\n\n-- Aggregate by month-year + funnel step\naggregated AS (\n    SELECT\n        month_year\n        , kpi_name\n        , funnel_step\n        , COUNT(DISTINCT deal_id) AS deals_count\n    FROM all_funnel\n    WHERE kpi_name IS NOT NULL\n    GROUP BY 1,2,3\n)\n\nSELECT *\nFROM aggregated\n\n\n    WHERE CONCAT(month_year, funnel_step) NOT IN \n          (SELECT CONCAT(month_year, funnel_step) FROM \"postgres\".\"public_pipedrive_analytics\".\"rep_sales_funnel_monthly\")\n", "relation_name": "\"postgres\".\"public_pipedrive_analytics\".\"rep_sales_funnel_monthly\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-09-25T04:56:44.577008Z", "completed_at": "2025-09-25T04:56:44.584747Z"}, {"name": "execute", "started_at": "2025-09-25T04:56:44.585016Z", "completed_at": "2025-09-25T04:56:44.617273Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04169297218322754, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.enpal_assessment_project.not_null_rep_sales_funnel_monthly_deals_count.4823926246", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect deals_count\nfrom \"postgres\".\"public_pipedrive_analytics\".\"rep_sales_funnel_monthly\"\nwhere deals_count is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-09-25T04:56:44.619629Z", "completed_at": "2025-09-25T04:56:44.621953Z"}, {"name": "execute", "started_at": "2025-09-25T04:56:44.622127Z", "completed_at": "2025-09-25T04:56:44.642328Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.024210214614868164, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.enpal_assessment_project.not_null_rep_sales_funnel_monthly_funnel_step.9afb8dfa61", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect funnel_step\nfrom \"postgres\".\"public_pipedrive_analytics\".\"rep_sales_funnel_monthly\"\nwhere funnel_step is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-09-25T04:56:44.645079Z", "completed_at": "2025-09-25T04:56:44.647859Z"}, {"name": "execute", "started_at": "2025-09-25T04:56:44.648050Z", "completed_at": "2025-09-25T04:56:44.673031Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.029641151428222656, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.enpal_assessment_project.not_null_rep_sales_funnel_monthly_kpi_name.8e933976f0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect kpi_name\nfrom \"postgres\".\"public_pipedrive_analytics\".\"rep_sales_funnel_monthly\"\nwhere kpi_name is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-09-25T04:56:44.675747Z", "completed_at": "2025-09-25T04:56:44.679215Z"}, {"name": "execute", "started_at": "2025-09-25T04:56:44.679393Z", "completed_at": "2025-09-25T04:56:44.700797Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.026451826095581055, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.enpal_assessment_project.not_null_rep_sales_funnel_monthly_month_year.a883701bfa", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect month_year\nfrom \"postgres\".\"public_pipedrive_analytics\".\"rep_sales_funnel_monthly\"\nwhere month_year is null\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 0.535210132598877, "args": {"strict_mode": false, "source_freshness_run_project_hooks": true, "use_colors_file": true, "partial_parse_file_diff": true, "skip_nodes_if_on_run_start_fails": false, "which": "build", "cache_selected_only": false, "macro_debugging": false, "require_explicit_package_overrides_for_builtin_materializations": true, "defer": false, "partial_parse": true, "favor_state": false, "quiet": false, "require_all_warnings_handled_by_warn_error": false, "invocation_command": "dbt build -s tag:reporting", "static_parser": true, "use_colors": true, "show_all_deprecations": false, "log_level": "info", "print": true, "show_resource_report": false, "vars": {}, "indirect_selection": "eager", "project_dir": "/Users/nv994t/Desktop/Enpal_Assessment/dbt_enpal_assessment", "require_nested_cumulative_type_params": false, "resource_types": [], "show": false, "state_modified_compare_vars": false, "upload_to_artifacts_ingest_api": false, "require_batched_execution_for_custom_microbatch_strategy": false, "validate_macro_args": false, "introspect": true, "populate_cache": true, "log_format_file": "debug", "log_path": "/Users/nv994t/Desktop/Enpal_Assessment/dbt_enpal_assessment/logs", "include_saved_query": false, "printer_width": 80, "require_resource_names_without_spaces": true, "exclude": [], "export_saved_queries": false, "log_format": "default", "send_anonymous_usage_stats": true, "profiles_dir": "/Users/nv994t/Desktop/Enpal_Assessment/dbt_enpal_assessment", "use_fast_test_edges": false, "exclude_resource_types": [], "empty": false, "require_yaml_configuration_for_mf_time_spines": false, "version_check": true, "state_modified_compare_more_unrendered_values": false, "log_file_max_bytes": 10485760, "warn_error_options": {"error": [], "warn": [], "silence": []}, "write_json": true, "select": ["tag:reporting"], "require_generic_test_arguments_property": true, "log_level_file": "debug"}}