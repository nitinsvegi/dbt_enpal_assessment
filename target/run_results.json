{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.11", "generated_at": "2025-09-26T09:29:46.303841Z", "invocation_id": "60328bf1-e139-4a98-95c9-a702db2aaf18", "invocation_started_at": "2025-09-26T09:29:42.965034Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-09-26T09:29:45.337750Z", "completed_at": "2025-09-26T09:29:45.489041Z"}, {"name": "execute", "started_at": "2025-09-26T09:29:45.490091Z", "completed_at": "2025-09-26T09:29:46.019506Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.6831319332122803, "adapter_response": {"_message": "INSERT 0 0", "code": "INSERT", "rows_affected": 0}, "message": "INSERT 0 0", "failures": null, "unique_id": "model.enpal_assessment_project.rep_sales_funnel_monthly", "compiled": true, "compiled_code": "\n\n-- Aggregates deal and activity data to create a monthly sales funnel view.\n\n-- Column definitions:\n-- month: Month of the activity or stage change (first day of month)\n-- kpi_name: Name of the KPI corresponding to the funnel step\n-- funnel_step: Funnel step identifier (Step 1, Step 2.1, etc.)\n-- deals_count: Count of unique deals in that month and funnel step\n\nWITH\n-- Stage-based funnel steps (from int_deal_changes)\nstage_funnel AS (\n    SELECT\n        -- EXTRACT(MONTH FROM deal_change_timestamp) AS month\n        TO_CHAR(deal_change_timestamp, 'MM-YYYY') AS month_year\n        ,  CASE \n            WHEN stage_name = 'Lead Generation' THEN 'Stage: Lead Generation'\n            WHEN stage_name = 'Qualified Lead' THEN 'Stage: Qualified Lead'\n            WHEN stage_name = 'Needs Assessment' THEN 'Stage: Needs Assessment'\n            WHEN stage_name = 'Proposal/Quote Preparation' THEN 'Stage: Proposal/Quote Preparation'\n            WHEN stage_name = 'Negotiation' THEN 'Stage: Negotiation'\n            WHEN stage_name = 'Closing' THEN 'Stage: Closing'\n            WHEN stage_name = 'Implementation/Onboarding' THEN 'Stage: Implementation/Onboarding'\n            WHEN stage_name = 'Follow-up/Customer Success' THEN 'Stage: Follow-up/Customer Success'\n            WHEN stage_name = 'Renewal/Expansion' THEN 'Stage: Renewal/Expansion'\n            ELSE NULL\n          END AS kpi_name\n        , CASE \n            WHEN stage_name = 'Lead Generation' THEN 'Step 1'\n            WHEN stage_name = 'Qualified Lead' THEN 'Step 2'\n            WHEN stage_name = 'Needs Assessment' THEN 'Step 3'\n            WHEN stage_name = 'Proposal/Quote Preparation' THEN 'Step 4'\n            WHEN stage_name = 'Negotiation' THEN 'Step 5'\n            WHEN stage_name = 'Closing' THEN 'Step 6'\n            WHEN stage_name = 'Implementation/Onboarding' THEN 'Step 7'\n            WHEN stage_name = 'Follow-up/Customer Success' THEN 'Step 8'\n            WHEN stage_name = 'Renewal/Expansion' THEN 'Step 9'\n            ELSE NULL\n          END AS funnel_step\n        , deal_id\n    FROM \"postgres\".\"pipedrive_analytics\".\"int_deal_changes\"\n    WHERE TRUE\n        AND stage_name IS NOT NULL\n),\n\n-- Activity-based funnel steps (from int_activity)\nactivity_funnel AS (\n    SELECT\n        -- EXTRACT(MONTH FROM activity_due_timestamp) AS month\n        TO_CHAR(activity_due_timestamp, 'MM-YYYY') AS month_year\n        , CASE \n            WHEN activity_type_short = 'meeting' THEN 'Activity: Sales Call 1'\n            WHEN activity_type_short = 'sc_2' THEN 'Activity: Sales Call 2'\n            WHEN activity_type_short = 'follow_up' THEN 'Activity: Follow-up/Customer Success'\n            WHEN activity_type_short = 'after_close_call' THEN 'Activity: Closing'\n            ELSE NULL\n          END AS kpi_name\n        , CASE \n            WHEN activity_type_short = 'meeting' THEN 'Step 2.1'\n            WHEN activity_type_short = 'sc_2' THEN 'Step 3.1'\n            WHEN activity_type_short = 'after_close_call' THEN 'Step 6'\n            WHEN activity_type_short = 'follow_up' THEN 'Step 8'\n            ELSE NULL\n         END AS funnel_step\n        , deal_id\n    FROM \"postgres\".\"pipedrive_analytics\".\"int_activity\"\n    WHERE TRUE\n        AND is_activity_done_status = TRUE -- Only consider completed activities\n        AND activity_type_short IN ('meeting','sc_2','follow_up','after_close_call')\n),\n\n-- Lost Reason-based funnel steps (from int_deal_changes)\nlost_reason_funnel AS (\n    SELECT\n        TO_CHAR(deal_change_timestamp, 'MM-YYYY') AS month_year\n        , CASE \n            WHEN lost_reason_name = 'Customer Not Ready' THEN 'Lost Reason: Customer Not Ready'\n            WHEN lost_reason_name = 'Pricing Issues' THEN 'Lost Reason: Pricing Issues'\n            WHEN lost_reason_name = 'Unreachable Customer' THEN 'Lost Reason: Unreachable Customer'\n            WHEN lost_reason_name = 'Product Mismatch' THEN 'Lost Reason: Product Mismatch'\n            WHEN lost_reason_name = 'Duplicate Entry' THEN 'Lost Reason: Duplicate Entry'\n            ELSE NULL\n        END AS kpi_name\n        , CASE \n            WHEN lost_reason_name = 'Customer Not Ready' THEN 'Step 1'\n            WHEN lost_reason_name = 'Pricing Issues' THEN 'Step 2'\n            WHEN lost_reason_name = 'Unreachable Customer' THEN 'Step 3'\n            WHEN lost_reason_name = 'Product Mismatch' THEN 'Step 4'\n            WHEN lost_reason_name = 'Duplicate Entry' THEN 'Step 5'\n            ELSE NULL\n        END AS funnel_step\n        , deal_id\n    FROM \"postgres\".\"pipedrive_analytics\".\"int_deal_changes\"\n    WHERE TRUE\n    AND lost_reason_name IS NOT NULL\n),\n\n-- Union all funnel events\nall_funnel AS (\n    SELECT * FROM stage_funnel\n    UNION ALL\n    SELECT * FROM activity_funnel\n    UNION ALL\n    SELECT * FROM lost_reason_funnel\n),\n\n-- Aggregate by month-year + funnel step\naggregated AS (\n    SELECT\n        month_year\n        , kpi_name\n        , funnel_step\n        , COUNT(DISTINCT deal_id) AS deals_count\n    FROM all_funnel\n    WHERE kpi_name IS NOT NULL\n    GROUP BY 1,2,3\n)\n\nSELECT *\nFROM aggregated\n\n\n    WHERE CONCAT(month_year, funnel_step) NOT IN \n          (SELECT CONCAT(month_year, funnel_step) FROM \"postgres\".\"pipedrive_analytics\".\"rep_sales_funnel_monthly\")\n", "relation_name": "\"postgres\".\"pipedrive_analytics\".\"rep_sales_funnel_monthly\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-09-26T09:29:46.030900Z", "completed_at": "2025-09-26T09:29:46.043628Z"}, {"name": "execute", "started_at": "2025-09-26T09:29:46.043966Z", "completed_at": "2025-09-26T09:29:46.101159Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.07530498504638672, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.enpal_assessment_project.not_null_rep_sales_funnel_monthly_deals_count.4823926246", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect deals_count\nfrom \"postgres\".\"pipedrive_analytics\".\"rep_sales_funnel_monthly\"\nwhere deals_count is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-09-26T09:29:46.106504Z", "completed_at": "2025-09-26T09:29:46.111338Z"}, {"name": "execute", "started_at": "2025-09-26T09:29:46.111660Z", "completed_at": "2025-09-26T09:29:46.148428Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.045172929763793945, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.enpal_assessment_project.not_null_rep_sales_funnel_monthly_funnel_step.9afb8dfa61", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect funnel_step\nfrom \"postgres\".\"pipedrive_analytics\".\"rep_sales_funnel_monthly\"\nwhere funnel_step is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-09-26T09:29:46.152320Z", "completed_at": "2025-09-26T09:29:46.157640Z"}, {"name": "execute", "started_at": "2025-09-26T09:29:46.157978Z", "completed_at": "2025-09-26T09:29:46.205286Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.055890798568725586, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.enpal_assessment_project.not_null_rep_sales_funnel_monthly_kpi_name.8e933976f0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect kpi_name\nfrom \"postgres\".\"pipedrive_analytics\".\"rep_sales_funnel_monthly\"\nwhere kpi_name is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-09-26T09:29:46.211440Z", "completed_at": "2025-09-26T09:29:46.216495Z"}, {"name": "execute", "started_at": "2025-09-26T09:29:46.216843Z", "completed_at": "2025-09-26T09:29:46.255873Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04684805870056152, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.enpal_assessment_project.not_null_rep_sales_funnel_monthly_month_year.a883701bfa", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect month_year\nfrom \"postgres\".\"pipedrive_analytics\".\"rep_sales_funnel_monthly\"\nwhere month_year is null\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 1.4974009990692139, "args": {"favor_state": false, "log_path": "/Users/nv994t/Desktop/Enpal_Assessment/dbt_enpal_assessment/logs", "skip_nodes_if_on_run_start_fails": false, "require_generic_test_arguments_property": true, "log_file_max_bytes": 10485760, "state_modified_compare_vars": false, "include_saved_query": false, "vars": {}, "resource_types": [], "source_freshness_run_project_hooks": true, "invocation_command": "dbt build -s tag:reporting", "use_colors": true, "static_parser": true, "log_format_file": "debug", "state_modified_compare_more_unrendered_values": false, "log_level_file": "debug", "profiles_dir": "/Users/nv994t/Desktop/Enpal_Assessment/dbt_enpal_assessment", "project_dir": "/Users/nv994t/Desktop/Enpal_Assessment/dbt_enpal_assessment", "require_resource_names_without_spaces": true, "exclude": [], "require_explicit_package_overrides_for_builtin_materializations": true, "print": true, "partial_parse_file_diff": true, "version_check": true, "exclude_resource_types": [], "export_saved_queries": false, "log_level": "info", "show_all_deprecations": false, "upload_to_artifacts_ingest_api": false, "indirect_selection": "eager", "macro_debugging": false, "partial_parse": true, "show": false, "log_format": "default", "use_fast_test_edges": false, "cache_selected_only": false, "introspect": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "strict_mode": false, "which": "build", "require_nested_cumulative_type_params": false, "show_resource_report": false, "require_batched_execution_for_custom_microbatch_strategy": false, "quiet": false, "require_yaml_configuration_for_mf_time_spines": false, "defer": false, "empty": false, "select": ["tag:reporting"], "require_all_warnings_handled_by_warn_error": false, "send_anonymous_usage_stats": true, "validate_macro_args": false, "populate_cache": true, "printer_width": 80, "use_colors_file": true, "write_json": true}}